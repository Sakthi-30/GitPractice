alter PROCEDURE PRVESSELDETAILESEARCH
(
	@ROWUSERCODE			INT
	,@VESSELCODE			VARCHAR(30)		= NULL
	,@VESSELNAME			VARCHAR(30)		= NULL
	,@SORTBY                VARCHAR(100)    = NULL
    ,@SORTDIRECTION         TINYINT         = NULL
    ,@PAGENUMBER            INT
    ,@PAGESIZE              INT
    ,@RESULTCOUNT           INT OUTPUT
    ,@TOTALPAGECOUNT        INT OUTPUT
)
AS
BEGIN
	SET NOCOUNT ON;
    DECLARE @ROWFROM BIGINT;
    DECLARE @ROWTO BIGINT; 
    DECLARE @TEMPTABLE TABLE (FLDVESSELDETAILEDEMOID UNIQUEIDENTIFIER, FLDROWNUMBER BIGINT IDENTITY(1,1));
 
    SET @SORTDIRECTION = ISNULL(@SORTDIRECTION, 0);

	INSERT INTO @TEMPTABLE (FLDVESSELDETAILEDEMOID)
    SELECT FLDVESSELDETAILEDEMOID
    FROM TBLVESSELDETAILEDEMO  (NOLOCK)
    WHERE 
        (@VESSELCODE IS NULL OR FLDVESSELCODE LIKE '%' + @VESSELCODE + '%')
        AND (@VESSELNAME IS NULL OR FLDVESSEELNAME LIKE '%' + @VESSELNAME + '%')

	SET @RESULTCOUNT = @@ROWCOUNT;
    SET @TOTALPAGECOUNT = DBO.FNTOTALPAGECOUNT(@RESULTCOUNT, @PAGESIZE);
    SET @ROWFROM = DBO.FNROWFROM(@PAGENUMBER, @PAGESIZE);
    SET @ROWTO = DBO.FNROWTO(@PAGENUMBER, @PAGESIZE);
 
    SELECT 
        
		E.FLDVESSELDETAILEDEMOID	
		,E.FLDVESSELCODE			

		,V.FLDVESSELNAMESDEMOID
		,V.FLDVESSELNAME			--E.FLDVESSEELNAME			--V.FLDVESSELNAMEDEMOID			n vessid
		,E.FLDVESSELFLAG			
		,E.FLDOFFICIALNUMBER		
		,E.FLDCALLSIGN			
		,E.FLDIMONUMBER			
		,E.FLDHULLNUMBER		

		,P.FLDPRINCIPLEDEMOID
		,P.FLDPRINCIPLENAME					--E.FLDPRINCIPAL				--P.FLDPRINCIPAL
		,E.FLDISACTIVE			
		,E.FLDCREATEDDATE			
		,E.FLDCREATEDBY			
		,E.FLDMODIFIEDDATE		
		,E.FLDMODIFIEDBY			
		,E.FLDDTKEY				

    FROM @TEMPTABLE T
    LEFT JOIN TBLVESSELDETAILEDEMO E (NOLOCK)
	ON T.FLDVESSELDETAILEDEMOID = E.FLDVESSELDETAILEDEMOID
	
	INNER JOIN TBLVESSELNAMESDEMO V
	ON E.FLDVESSEELNAME = V.FLDVESSELNAMESDEMOID

	INNER JOIN TBLPRINCIPLEDEMO P
	ON E.FLDPRINCIPAL = P.FLDPRINCIPLEDEMOID

    WHERE T.FLDROWNUMBER BETWEEN @ROWFROM AND @ROWTO
    ORDER BY T.FLDROWNUMBER;
 
END;







ALTER PROCEDURE PRVESSELDETAILEEDIT
(
	@VESSELDETAILEDEMOID		UNIQUEIDENTIFIER
)
AS
BEGIN
	SELECT 
		D.FLDVESSELCODE
		,V.FLDVESSELNAMESDEMOID
		, V.FLDVESSELNAME
		, D.FLDIMONUMBER
		,P.FLDPRINCIPLEDEMOID
		, P.FLDPRINCIPLENAME
	FROM TBLVESSELDETAILEDEMO D
	INNER JOIN TBLVESSELNAMESDEMO V
	ON D.FLDVESSEELNAME = V.FLDVESSELNAMESDEMOID
	INNER JOIN TBLPRINCIPLEDEMO P
	ON D.FLDPRINCIPAL = P.FLDPRINCIPLEDEMOID
	WHERE FLDVESSELDETAILEDEMOID = @VESSELDETAILEDEMOID		--8FEDA8F0-9DCC-41E9-9818-D9FB307BBF73
END


exec PRVESSELDETAILEEDIT '8FEDA8F0-9DCC-41E9-9818-D9FB307BBF73'